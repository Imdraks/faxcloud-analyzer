<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport - FaxCloud Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-shell" data-report-id="{{ report.id }}">
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-title">FaxCloud Analyzer</div>
                <div class="brand-subtitle">Interface interne</div>
            </div>

            <nav class="side-nav">
                <a class="side-link icon-only" href="/" aria-label="Accueil" title="Accueil">
                    <span class="side-link-left">
                        <svg class="side-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M3 11.5L12 4l9 7.5" />
                            <path d="M5 10.5V20h14v-9.5" />
                        </svg>
                        <span class="sr-only">Accueil</span>
                    </span>
                </a>
                <a class="side-link icon-only active" href="/reports" aria-label="Rapports" title="Rapports">
                    <span class="side-link-left">
                        <svg class="side-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M7 3h7l3 3v15H7z" />
                            <path d="M14 3v4h4" />
                            <path d="M9 12h6" />
                            <path d="M9 16h6" />
                        </svg>
                        <span class="sr-only">Rapports</span>
                    </span>
                </a>
            </nav>

            <div class="side-footer">v1.0</div>
        </aside>

        <div class="content">
            <header class="topbar">
                <div>
                    <h1 class="page-title">{{ report.contract_id or 'Rapport' }}</h1>
                    <p class="page-subtitle">{{ report.date_debut or '—' }} → {{ report.date_fin or '—' }}</p>
                    {% if report.source_filename %}
                        <p class="text-muted" style="margin-top: 0.25rem;"><span class="meta-label">Fichier</span> {{ report.source_filename }}</p>
                    {% endif %}
                </div>
                <div class="topbar-actions">
                    <a class="btn" href="/api/report/{{ report.id }}/export.csv">Télécharger CSV</a>
                    <a class="btn" href="/api/report/{{ report.id }}/export.json">Télécharger JSON</a>
                    <button id="deleteReportBtn" class="btn" type="button">Supprimer</button>
                </div>
            </header>

            <main class="main">
                <section class="section">
                    <h2>Résumé</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h4>Total FAX</h4>
                            <p class="stat-value">{{ report.total_fax }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>FAX SF</h4>
                            <p class="stat-value">{{ report.fax_sf or report.fax_envoyes or 0 }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>FAX RF</h4>
                            <p class="stat-value">{{ report.fax_rf or report.fax_recus or 0 }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Pages réelles total</h4>
                            <p class="stat-value">{{ report.pages_reelles_totales or report.pages_totales or 0 }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Pages réelles SF</h4>
                            <p class="stat-value">{{ report.pages_reelles_sf or report.pages_envoyees or 0 }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Pages réelles RF</h4>
                            <p class="stat-value">{{ report.pages_reelles_rf or report.pages_recues or 0 }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Erreurs</h4>
                            <p class="stat-value">{{ report.erreurs_totales }}</p>
                        </div>
                        <div class="stat-card">
                            <h4>Taux de réussite</h4>
                            <p class="stat-value">{{ report.taux_reussite }}%</p>
                        </div>
                    </div>
                </section>

                {% if report.qr_path %}
                    <section class="section">
                        <h2>QR Code</h2>
                        <img src="/api/report/{{ report.id }}/qr" alt="QR Code" style="width: 200px; height: 200px;">
                    </section>
                {% endif %}

                <section class="section">
                    <h2>Entrées</h2>
                    <p class="text-muted">Affichage par pages pour rester performant.</p>

                    <div class="filter-bar" style="margin-top: 1rem;">
                        <div class="filter-field">
                            <label for="entriesTypeFilter" class="filter-label">Type</label>
                            <select id="entriesTypeFilter" class="input">
                                <option value="">Tous</option>
                                <option value="send">send</option>
                                <option value="receive">receive</option>
                            </select>
                        </div>

                        <div class="filter-field">
                            <label for="entriesValidFilter" class="filter-label">Valide</label>
                            <select id="entriesValidFilter" class="input">
                                <option value="">Tous</option>
                                <option value="1">Oui</option>
                                <option value="0">Non</option>
                            </select>
                        </div>

                        <div class="filter-field">
                            <label for="entriesDateFrom" class="filter-label">Du</label>
                            <input id="entriesDateFrom" class="input" type="date">
                        </div>

                        <div class="filter-field">
                            <label for="entriesDateTo" class="filter-label">Au</label>
                            <input id="entriesDateTo" class="input" type="date">
                        </div>

                        <div class="filter-field">
                            <label for="entriesPagesMin" class="filter-label">Pages min</label>
                            <input id="entriesPagesMin" class="input" type="number" min="1" step="1" placeholder="1">
                        </div>

                        <div class="filter-field">
                            <label for="entriesPagesMax" class="filter-label">Pages max</label>
                            <input id="entriesPagesMax" class="input" type="number" min="1" step="1" placeholder="10">
                        </div>

                        <div class="filter-field filter-grow">
                            <label for="entriesSearchInput" class="filter-label">Recherche</label>
                            <input id="entriesSearchInput" class="input" type="text" placeholder="Utilisateur ou numéro…">
                        </div>

                        <div class="filter-field">
                            <label for="entriesOrder" class="filter-label">Tri</label>
                            <select id="entriesOrder" class="input">
                                <option value="asc">Date ↑</option>
                                <option value="desc">Date ↓</option>
                            </select>
                        </div>

                        <div class="filter-actions">
                            <button id="entriesApplyFilters" class="btn" type="button">Filtrer</button>
                            <button id="entriesClearFilters" class="btn" type="button">Réinitialiser</button>
                            <button id="entriesExportFilteredCsv" class="btn" type="button">CSV filtré</button>
                            <button id="entriesExportFilteredJson" class="btn" type="button">JSON filtré</button>
                            <button id="entriesCopyLink" class="btn" type="button">Copier le lien</button>
                        </div>
                    </div>

                    <div id="entriesPagination" class="pagination" style="margin-top: 1rem;"></div>
                    <div id="entriesFilterSummary" class="filter-summary" style="margin-top: 0.75rem;"></div>
                    <p id="entriesStatus" class="text-muted" style="margin-top: 0.75rem;"></p>

                    <div class="table-wrap" style="margin-top: 1rem;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date/Heure</th>
                                    <th>Type</th>
                                    <th>Pages</th>
                                    <th>Utilisateur</th>
                                    <th>Numéro</th>
                                    <th>Valide</th>
                                </tr>
                            </thead>
                            <tbody id="entriesTableBody"></tbody>
                        </table>
                    </div>

                    <div style="margin-top: 1.25rem;">
                        <a href="/reports" class="btn">Retour</a>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/report.js') }}"></script>
</body>
</html>
