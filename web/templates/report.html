<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport - FaxCloud Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container" data-report-id="{{ report.id }}">
        <header class="header">
            <h1>üìä FaxCloud Analyzer</h1>
            <p>D√©tail d'un rapport</p>
            <nav>
                <a href="/">Accueil</a>
                <a href="/reports">Rapports</a>
            </nav>
        </header>

        <main class="main">
            <section class="section">
                <h2>{{ report.contract_id or 'Rapport' }}</h2>
                <p><strong>P√©riode:</strong> {{ report.date_debut or '‚Äî' }} ‚Üí {{ report.date_fin or '‚Äî' }}</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Total FAX</h4>
                        <p class="stat-value">{{ report.total_fax }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>FAX SF</h4>
                        <p class="stat-value">{{ report.fax_sf or report.fax_envoyes or 0 }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>FAX RF</h4>
                        <p class="stat-value">{{ report.fax_rf or report.fax_recus or 0 }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Pages r√©elles total</h4>
                        <p class="stat-value">{{ report.pages_reelles_totales or report.pages_totales or 0 }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Pages r√©elles SF</h4>
                        <p class="stat-value">{{ report.pages_reelles_sf or report.pages_envoyees or 0 }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Pages r√©elles RF</h4>
                        <p class="stat-value">{{ report.pages_reelles_rf or report.pages_recues or 0 }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Erreurs</h4>
                        <p class="stat-value">{{ report.erreurs_totales }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>Taux de r√©ussite</h4>
                        <p class="stat-value">{{ report.taux_reussite }}%</p>
                    </div>
                </div>

                {% if report.qr_path %}
                    <div style="margin-top: 2rem;">
                        <h3>üì± QR Code</h3>
                        <img src="/api/report/{{ report.id }}/qr" alt="QR Code" style="width: 200px; height: 200px;">
                    </div>
                {% endif %}

                <div style="margin-top: 2rem;">
                    <h3>üìÑ Entr√©es (pagin√©)</h3>
                    <p class="text-muted">Pour √©viter de charger 25k lignes d'un coup, on affiche par pages.</p>

                    <div class="actions-row">
                        <a class="btn" href="/api/report/{{ report.id }}/export.csv">T√©l√©charger CSV</a>
                        <a class="btn" href="/api/report/{{ report.id }}/export.json">T√©l√©charger JSON</a>
                        <button id="loadMoreBtn" class="btn" type="button">Charger plus</button>
                    </div>

                    <p id="entriesStatus" class="text-muted" style="margin-top: 0.75rem;"></p>

                    <div class="table-wrap" style="margin-top: 1rem;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date/Heure</th>
                                    <th>Type</th>
                                    <th>Pages</th>
                                    <th>Utilisateur</th>
                                    <th>Num√©ro</th>
                                    <th>Valide</th>
                                </tr>
                            </thead>
                            <tbody id="entriesTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <a href="/reports" class="btn">‚Üê Retour</a>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>FaxCloud Analyzer v1.0</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/report.js') }}"></script>
</body>
</html>
