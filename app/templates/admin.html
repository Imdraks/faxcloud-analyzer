<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - FaxCloud Analyzer</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>üìä FaxCloud Analyzer</h1>
                <nav class="nav">
                    <a href="/" class="nav-link">Dashboard</a>
                    <a href="/reports" class="nav-link">Rapports</a>
                    <a href="/admin" class="nav-link active">Admin</a>
                </nav>
            </div>
        </header>

        <main class="main">
            <h2>üîß Panneau d'Administration</h2>

            <!-- Metrics Grid -->
            <section class="metrics-grid">
                <div class="metric-card">
                    <h3>Utilisation CPU</h3>
                    <p class="metric-value" id="cpu-usage">35%</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 35%"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <h3>M√©moire</h3>
                    <p class="metric-value" id="memory-usage">42%</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 42%"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <h3>Disque</h3>
                    <p class="metric-value" id="disk-usage">28%</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 28%"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <h3>Taux d'Erreur</h3>
                    <p class="metric-value" id="error-rate">2.1%</p>
                    <p class="metric-label">Entr√©es invalides</p>
                </div>
            </section>

            <!-- Health Status -->
            <section class="health-section">
                <h3>√âtat du Syst√®me</h3>
                <div class="health-items">
                    <div class="health-item">
                        <span class="health-indicator ok"></span>
                        <span>Base de donn√©es</span>
                        <span class="health-status">‚úì Online</span>
                    </div>
                    <div class="health-item">
                        <span class="health-indicator ok"></span>
                        <span>Service d'Import</span>
                        <span class="health-status">‚úì Online</span>
                    </div>
                    <div class="health-item">
                        <span class="health-indicator ok"></span>
                        <span>G√©n√©rateur PDF</span>
                        <span class="health-status">‚úì Online</span>
                    </div>
                    <div class="health-item">
                        <span class="health-indicator ok"></span>
                        <span>Cache Redis</span>
                        <span class="health-status">‚úì Online</span>
                    </div>
                </div>
            </section>

            <!-- Activity Chart -->
            <section class="chart-container">
                <h3>Activit√© (derni√®res 24h)</h3>
                <canvas id="activityChart"></canvas>
            </section>

            <!-- Logs -->
            <section class="logs-section">
                <h3>Logs Syst√®me</h3>
                <div class="logs-viewer">
                    <div class="log-line">
                        <span class="log-time">2024-01-10 14:32:15</span>
                        <span class="log-level info">INFO</span>
                        <span class="log-msg">Rapport #254 import√© (2.3 MB, 1250 entr√©es)</span>
                    </div>
                    <div class="log-line">
                        <span class="log-time">2024-01-10 14:25:42</span>
                        <span class="log-level info">INFO</span>
                        <span class="log-msg">Validation compl√©t√©e: 98.5% de succ√®s</span>
                    </div>
                    <div class="log-line">
                        <span class="log-time">2024-01-10 14:18:05</span>
                        <span class="log-level warning">WARN</span>
                        <span class="log-msg">M√©moire: utilisation √©lev√©e (75%)</span>
                    </div>
                    <div class="log-line">
                        <span class="log-time">2024-01-10 14:10:33</span>
                        <span class="log-level info">INFO</span>
                        <span class="log-msg">Nettoyage des fichiers temporaires</span>
                    </div>
                    <div class="log-line">
                        <span class="log-time">2024-01-10 14:05:18</span>
                        <span class="log-level success">OK</span>
                        <span class="log-msg">Export PDF g√©n√©r√©: report_254.pdf</span>
                    </div>
                </div>
            </section>

            <!-- System Info -->
            <section class="system-info">
                <h3>Informations Syst√®me</h3>
                <table class="info-table">
                    <tr>
                        <td>Version</td>
                        <td>3.0.0</td>
                    </tr>
                    <tr>
                        <td>Base de donn√©es</td>
                        <td>MySQL 8.0 / In-Memory</td>
                    </tr>
                    <tr>
                        <td>Serveur Web</td>
                        <td>Flask 3.1.2</td>
                    </tr>
                    <tr>
                        <td>Uptime</td>
                        <td id="uptime">-</td>
                    </tr>
                    <tr>
                        <td>Rapports Totaux</td>
                        <td id="total-reports">0</td>
                    </tr>
                    <tr>
                        <td>Entr√©es Trait√©es</td>
                        <td id="total-entries">0</td>
                    </tr>
                </table>
            </section>
        </main>

        <footer class="footer">
            <p>&copy; 2024 FaxCloud Analyzer v3.0 | Administration</p>
        </footer>
    </div>

    <script src="{{ url_for('web.static', filename='js/app.js') }}"></script>
    <script>
        async function loadMetrics() {
            try {
                const response = await fetch('/api/admin/metrics');
                const metrics = await response.json();
                
                document.getElementById('cpu-usage').textContent = metrics.cpu_usage + '%';
                document.getElementById('memory-usage').textContent = metrics.memory_usage + '%';
                document.getElementById('disk-usage').textContent = metrics.disk_usage + '%';
                document.getElementById('error-rate').textContent = metrics.error_rate + '%';
                document.getElementById('total-reports').textContent = metrics.reports_today;
                document.getElementById('total-entries').textContent = metrics.entries_today;
                
                initActivityChart();
            } catch (error) {
                console.error('Erreur:', error);
            }
        }

        function initActivityChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['00h', '04h', '08h', '12h', '16h', '20h', '24h'],
                    datasets: [{
                        label: 'Entr√©es trait√©es',
                        data: [45, 38, 120, 250, 180, 95, 50],
                        backgroundColor: '#00d4ff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', loadMetrics);
    </script>
</body>
</html>
